---
import fs from 'fs/promises'
import Base from '../../base.astro'

export async function getStaticPaths() {
	const songFiles = import.meta.glob('/songs/*.js')
	return Object.keys(songFiles).map((filename) => ({params: {
		song_id: filename.replace('/songs/','').replace('.js', '')
	}}))
}

const {song_id} = Astro.params
const file = await fs.readFile(`./songs/${song_id}.js`)
---
<Base>
	<main>
		<button id="play">Play</button>
		<button id="stop">Stop</button>
		<a href={`/edit/${song_id}`}>Edit</a>
		<pre id="song">{file.toString()}</pre>
	</main>
	<script>
		import * as Strudel from '@strudel/web/web.mjs'
		
		Strudel.initStrudel()
		const song = document.getElementById('song').innerText

		document.getElementById('play').addEventListener('click', () => Strudel.evaluate(song))
		document.getElementById('stop').addEventListener('click', () => Strudel.hush())
	</script>
	<style>
		main
		{
			z-index: 999;
			position: relative;
		}
	</style>
</Base>
